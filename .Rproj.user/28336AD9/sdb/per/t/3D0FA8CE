{
    "collab_server" : "",
    "contents" : "crossmap_fns=(\"/work-zfs/abattle4/lab_data/annotation/mappability_hg19_gencode19/hg19_cross_mappability_strength.txt\"  \\\n              \"/work-zfs/abattle4/lab_data/annotation/mappability_hg19_gencode19/hg19_cross_mappability_strength_symmetric_mean.txt\"  \\\n              \"/work-zfs/abattle4/lab_data/annotation/mappability_hg19_gencode19/hg19_cross_mappability_strength_kmer_count_normalized.txt\"  \\\n              \"/work-zfs/abattle4/lab_data/annotation/mappability_hg19_gencode19/hg19_cross_mappability_strength_kmer_count_normalized_symmetric_mean.txt\")\nroot_out_dirs=(\"/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7\" \\\n               \"/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_symmetric_mean\" \\\n               \"/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_kmer_count_normalized\" \\\n               \"/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_kmer_count_normalized_symmetric_mean\" )\nsymmetrics=(FALSE TRUE FALSE TRUE)\ntop_n_pair=10000\n# crossmap_labels=('k' 'k-mean' 'k-normalized' 'k-normalized-mean')  # comma-separated labels\n# crossmap_comp_dir=\"/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_crossmap_comparison\"\n\n#tissues=('Whole_Blood')\ntissues=('Whole_Blood'  'Muscle_Skeletal' 'Thyroid'  'Skin_Sun_Exposed_Lower_leg' 'Testis')\ngtex_expr_dir=\"/work-zfs/abattle4/lab_data/GTEx_v7_cisEQTL/GTEx_Analysis_v7_eQTL_expression_matrices\"\nroot_in_dir=\"/work-zfs/abattle4/ashis/progdata/misc/cross_mappability/gtex_v7\"\ncrossmap_analysis_prog_dir=\"/work-zfs/abattle4/ashis/prog/misc/cross_mappability\"\ngene_annot_fn=\"/work-zfs/abattle4/lab_data/annotation/gencode.v19/gencode.v19.annotation.gene.txt\"\nmappability_fn=\"/work-zfs/abattle4/lab_data/annotation/mappability_hg19_gencode19/avg_mappability_Exon_UTR.txt\"\nroot_eqtl_dir=\"/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_symmetric_mean/trans_eqtl\"\n\nN_rand=1000\n\nroot_matrix_eqtl_dir=\"$root_eqtl_dir/matrix_eqtls\"\nmatrix_eqtl_metadata_dir=\"$root_eqtl_dir/matrix_eqtls_metadata\"\ncis_d=1e6\nbest_cis_snp_dir=\"$root_eqtl_dir/best_cis_snp_per_gene_${cis_d}\"\n\ntrnas_eqtl_dirs=('/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_symmetric_mean/trans_eqtl/trans_eqtl_cross_chr' \\\n                '/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_symmetric_mean/trans_eqtl/trans_eqtl_cross_chr_mappability_0.8' )\n                #'/work-zfs/abattle4/ashis/progres/misc/cross_mappability/gtex_v7_symmetric_mean/trans_eqtl/trans_eqtl_cross_chr_mappability_0.8_crossmap_500000b' )\n\ntrans_eqtl_fn_pfx=\"\"\ntrans_eqtl_fn_sfx=('_cross_chr_trans_eqtl_fdr_0.05.txt' \\\n                  '_cross_chr_map_trans_eqtl_fdr_0.05.txt' )\n                  #'_cross_chr_map_cross_trans_eqtl_fdr_0.05.txt' )\n\ntrans_eqtl_pval_fn_sfx=('_cross_chr_trans_eqtl_all_p_1e-5.txt' \\\n                  '_cross_chr_map_trans_eqtl_all_p_1e-5.txt' )\n\n########################################## slurm utility\nget_slurm_header()\n{\n  if [ $# -lt 9 ]; then \n         echo \"#not enough arguments in ${FUNCNAME}.\"; \n       return -1; \n       fi\n       \n       partition=$1\n       workdir=$2\n       time=$3\n       nodes=$4\n       ntasks=$5\n       mem=$6\n       job_name=$7\n       out_fn=$8\n       err_fn=$9\n       \n       cmd_header=\"#\"'!'\"/bin/sh\"\n       cmd_header=\"$cmd_header\\n#SBATCH --partition=${partition}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --workdir=${workdir}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --time=${time}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --nodes=${nodes}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --ntasks=${ntasks}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --mem=${mem}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --job-name=${job_name}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --output=${out_fn}\"\n       cmd_header=\"$cmd_header\\n#SBATCH --error=${err_fn}\"\n       cmd_header=\"$cmd_header\\n\"\n       \n       echo $cmd_header\n       return 0\n}\n##########################################\n\ntissues_str=${tissues[0]}\nfor((i=1; i<${#tissues[@]}; i++))\ndo\n  tissues_str=\"$tissues_str,${tissues[$i]}\"\ndone\n\n#### combine eqtls\nfor((ti=0; ti<${#trnas_eqtl_dirs[@]}; ti++))\ndo\n  tdir=${trnas_eqtl_dirs[$ti]}\n  sfx=${trans_eqtl_fn_sfx[$ti]}\n  pfx=$trans_eqtl_fn_pfx\n  \n  combined_dir=\"$tdir/combined_eqtls\"\n  if [ ! -d $combined_dir ] ; then mkdir $combined_dir; fi\n  combined_eqtl_pfx=\"$combined_dir/${pfx}combined${sfx}\"\n  combined_eqtl_pfx=$(echo $combined_eqtl_pfx | sed 's/.txt//g')\n  \n  cd $crossmap_analysis_prog_dir\n  Rscript combined_trans_eqtl_results.R -dir $tdir -tissues \"$tissues_str\" -pfx \"$pfx\" -sfx \"$sfx\" -o $combined_eqtl_pfx\ndone\n\n### annotate\nfor(( idx=0; $idx<${#crossmap_fns[@]}; idx++ ))\ndo\n  crossmap_fn=${crossmap_fns[$idx]}\n  root_out_dir=${root_out_dirs[$idx]}\n  eqtl_crossmap_dir=\"$root_out_dir/eqtl_crossmap\"\n  if [ ! -d $eqtl_crossmap_dir ]; then mkdir $eqtl_crossmap_dir; fi\n  \n  for((ti=0; ti < ${#trnas_eqtl_dirs[@]}; ti++))\n  do\n    tdir=${trnas_eqtl_dirs[$ti]}\n    sfx=${trans_eqtl_fn_sfx[$ti]}\n    pfx=$trans_eqtl_fn_pfx\n    combined_eqtl_fn=\"$tdir/combined_eqtls/${pfx}combined$(echo $sfx | sed 's/.txt$/.all.unique.txt/g')\"\n    annotated_combined_eqtl_dir=\"$eqtl_crossmap_dir/$(basename $tdir)\"\n    \n    if [ ! -f $combined_eqtl_fn ] ; then continue; fi\n    if [ ! -d $annotated_combined_eqtl_dir ] ; then mkdir $annotated_combined_eqtl_dir; fi\n    \n    echo \"annotating $(basename $tdir) -- $(basename $crossmap_fn)\"\n    \n    annotated_combined_eqtl_fn=\"$annotated_combined_eqtl_dir/$(basename $combined_eqtl_fn)\"\n    annotated_combined_eqtl_fn=$(echo $annotated_combined_eqtl_fn | sed 's/.txt$/.crossmap.txt/g')\n    cd $crossmap_analysis_prog_dir\n    log_fn=\"$annotated_combined_eqtl_dir/annoate_eqtl_crossmap_combined_eqtl.log\"\n    #Rscript annoate_eqtl_crossmap.R -eqtl $combined_eqtl_fn -cross $crossmap_fn -d $cis_d -permute FALSE -genperm FALSE -gencode $gene_annot_fn -o $annotated_combined_eqtl_fn 2>&1 | tee $log_fn\n    \n    ### annotate individual tissues\n    cd $crossmap_analysis_prog_dir\n    for((tisi=0; tisi<${#tissues[@]}; tisi++ ))\n    do\n      tissue=${tissues[$tisi]}\n      echo \"annotating $tissue in $(basename $tdir) -- $(basename $crossmap_fn)\"\n      eqtl_fn=\"$tdir/${tissue}${trans_eqtl_pval_fn_sfx[$ti]}\"\n      \n      annotated_eqtl_fn=\"$annotated_combined_eqtl_dir/${tissue}${trans_eqtl_pval_fn_sfx[$ti]}\"\n      annotated_eqtl_fn=$(echo $annotated_eqtl_fn | sed 's/.txt$/.crossmap.txt/g')\n      log_fn=$(echo $annotated_eqtl_fn | sed 's/.txt$/.log/g')\n      Rscript annoate_eqtl_crossmap.R -eqtl $eqtl_fn -cross $crossmap_fn -d $cis_d -permute FALSE -genperm FALSE -gencode $gene_annot_fn -o $annotated_eqtl_fn 2>&1 | tee $log_fn\n    done\n\n  done\ndone\n\n\n### cross-map  plots\nfor(( idx=0; $idx<${#crossmap_fns[@]}; idx++ ))\ndo\n  crossmap_fn=${crossmap_fns[$idx]}\n  root_out_dir=${root_out_dirs[$idx]}\n  eqtl_crossmap_dir=\"$root_out_dir/eqtl_crossmap\"\n  if [ ! -d $eqtl_crossmap_dir ]; then echo \"no eqtl cross-map directory.\"; continue; fi\n  \n  for((ti=0; ti < ${#trnas_eqtl_dirs[@]}; ti++))\n  do\n    tdir=${trnas_eqtl_dirs[$ti]}\n    sfx=${trans_eqtl_fn_sfx[$ti]}\n    pfx=$trans_eqtl_fn_pfx\n    combined_eqtl_fn=\"$tdir/combined_eqtls/${pfx}combined$(echo $sfx | sed 's/.txt$/.all.unique.txt/g')\"\n    annotated_combined_eqtl_dir=\"$eqtl_crossmap_dir/$(basename $tdir)\"\n    \n    if [ ! -f $combined_eqtl_fn ] ; then continue; fi\n    if [ ! -d $annotated_combined_eqtl_dir ] ; then echo \"no annotated combined eqtl directory.\"; continue; fi\n    \n    echo \"annotating $(basename $tdir) -- $(basename $crossmap_fn)\"\n    \n    annotated_combined_eqtl_fn=\"$annotated_combined_eqtl_dir/$(basename $combined_eqtl_fn)\"\n    annotated_combined_eqtl_fn=$(echo $annotated_combined_eqtl_fn | sed 's/.txt$/.crossmap.txt/g')\n    combined_eqtl_plt_fn=$(echo $annotated_combined_eqtl_fn | sed 's/.txt$/.pdf/g')\n    rm \"$combined_eqtl_plt_fn.pdf\"\n    cd $crossmap_analysis_prog_dir\n    Rscript explore_eqtl_cross_mappability.R -eqtl $annotated_combined_eqtl_fn -gencode $gene_annot_fn -o $combined_eqtl_plt_fn\n  done\ndone\n",
    "created" : 1541126494267.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3566611981",
    "id" : "3D0FA8CE",
    "lastKnownWriteTime" : 1533991421,
    "last_content_update" : 1533991421,
    "path" : "~/github/misc/cross_mappability/run_eqtl_crossmap_analysis.sh",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "sh"
}